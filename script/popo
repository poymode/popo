#! /usr/bin/env ruby

require 'optparse'
require 'yaml'
require 'fileutils'

if File.symlink?(__FILE__)
  POPO_BASE_PATH = File.expand_path('../../', File.readlink(__FILE__))
else
  POPO_BASE_PATH = File.expand_path('../../', __FILE__)
end

require File.join(POPO_BASE_PATH, 'lib/popo')
require File.join(POPO_BASE_PATH, 'lib/hash')

options = {}

optparse = OptionParser.new do |opts|
  opts.banner = "Popo tool."

  opts.separator "Options:"

  opts.on('-p', '--path PATH', 'Target path') do |path|
    options[:path] = path
  end

  opts.on('-t', '--target TARGET', 'Deployment target') do |target|
    options[:target] = target
  end

  opts.on('-u', '--user USER', 'Username') do |user|
    options[:user] = user
  end

  opts.on('-m', '--manifest MANIFEST', 'Deployment target manifesto') do |manifest|
    options[:manifest] = manifest
  end

  opts.on('-s', '--source URL', 'Source for manifest') do |source|
    options[:source] = source
  end

  opts.on('-n', '--no-color', 'Turn off shell colors') do |color|
    ENV['popo_no_color'] = ''
  end

  opts.on('-h', '--help', 'Display this screen') do
    puts opts
    exit
  end
end

optparse.parse!

if ARGV.length > 0
  args = ARGV.dup
  Popo::Initializer.boot(args, options)
else
  puts optparse.help
end

