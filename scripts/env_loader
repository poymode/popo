#!/usr/bin/ruby
require 'yaml'

ROOT_PATH = File.expand_path(File.join(File.dirname(__FILE__), '..'))
BASH_PATH = `which bash`.strip
ENV_PATH = `which env`.strip

env_config_file = File.join(ROOT_PATH, 'scripts/env_loader.yml')

if File.exists? env_config_file
  env_conf = YAML.load_file(env_config_file)
  popo_path = env_conf['popo_path']
  popo_target = env_conf['popo_target']
  envrc = "#{ROOT_PATH}/#{env_conf['envrc_path']}"
else
  puts "envrc file not found. Byebye!"
  exit(-1)
end

cmd = ARGV.join(' ')

finale = "#{ENV_PATH} popo_path=#{popo_path} #{BASH_PATH} -c 'source #{envrc}; cd #{popo_path}; #{cmd}'"
#puts finale
exec(finale)

